# -----------------------------------------------------------
      # INSTALL DEPENDENCIES (LIBVNCSERVER) VIA VCPKG
      # -----------------------------------------------------------
      - name: Install LibVNCServer via vcpkg
        run: |
          vcpkg install libvncserver:x64-windows
          vcpkg install lzo:x64-windows
        shell: pwsh

      # -----------------------------------------------------------
      # PATCH VEYON (Keep your existing patch)
      # -----------------------------------------------------------
      - name: Patch Veyon CMakeLists for Qt5
        shell: pwsh
        run: |
          $file = "CMakeLists.txt"
          (Get-Content $file) -replace 'find_package\(Qt6', 'find_package(Qt5' | Set-Content $file
          Write-Host "Patched Veyon to use Qt5."

      # -----------------------------------------------------------
      # CONFIGURE VEYON
      # -----------------------------------------------------------
      - name: Configure Veyon Build
        shell: pwsh
        run: |
          mkdir build
          cd build
          cmake -G "Ninja" `
            -DCMAKE_BUILD_TYPE=Release `
            -DCMAKE_TOOLCHAIN_FILE="$env:VCPKG_INSTALLATION_ROOT/scripts/buildsystems/vcpkg.cmake" `
            -DVCPKG_TARGET_TRIPLET=x64-windows `
            -DCMAKE_PREFIX_PATH="${{ steps.install-qt.outputs.qt_dir }};${{ runner.temp }}/qca-install" `
            ..

      # -----------------------------------------------------------
      # BUILD VEYON
      # -----------------------------------------------------------
      - name: Build Veyon
        run: |
          cd build
          ninja
